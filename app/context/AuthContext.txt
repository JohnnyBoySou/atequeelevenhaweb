'use client';
import { createContext, useState } from "react"; 
import Router from "next/router";
import firebase from "@api/firebase"
const AuthContext = createContext();

export function AuthProvider ({ children }) {

    const [user, setuser] = useState();
    const [loading, setloading] = useState();

    const signin = () => {
        
        try {
            setloading(true)
            return firebase
            .auth()
            .signInWithPopup(new firebase.auth.GoogleAuthProvider())
            .then((response) => {
                setuser(response.user);
                Router.push("/pins");
            })

        }finally {
            setloading(false);
        }
    }

    const signout = () => {
        try {
            setloading(true)
            return firebase
            .auth()
            .signOut()
            .then(() => {
                setuser(null);
                Router.push("/");
            })

        }finally {
            setloading(false);
        }
    }


    return (
        <AuthContext.Provider value={{ 
            user,
            loading,
            signin,
            signout,
        }}>
            {children}
        </AuthContext.Provider>
    );
    }

export const AuthConsumer = AuthContext.Consumer;    
export default AuthContext;